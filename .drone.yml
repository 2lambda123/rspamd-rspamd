workspace:
  base: /rspamd

pipeline:

  build:
    # https://github.com/rspamd/rspamd-build-docker/blob/master/ubuntu-build/Dockerfile
    image: rspamd/ci-ubuntu-build
    group: build
    commands:
      - mkdir /rspamd/build /rspamd/install
      - cd /rspamd/build
      - cmake $${CI_WORKSPACE} -DENABLE_COVERAGE=ON -DENABLE_LIBUNWIND=ON -DCMAKE_INSTALL_PREFIX=/rspamd/install
      - ncpu=$(getconf _NPROCESSORS_ONLN)
      - make -j $ncpu install
      - make -j $ncpu rspamd-test

  eslint:
    image: node:latest
    group: build
    commands:
      - npm install
      - ./node_modules/.bin/eslint -v && ./node_modules/.bin/eslint ./
